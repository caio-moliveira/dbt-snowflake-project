version: 2

models:
  - name: revenue_by_author
    description: "Calculates total revenue and books sold by each author, aggregating data from book sales and pricing."
    tags:
      - sales
      - revenue
    columns:
      - name: author_id
        description: "Unique identifier for each author."
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('dim_authors')
              field: author_id
      - name: author_name
        description: "Name of the author."
      - name: total_revenue
        description: "Total revenue generated by the author's books."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of books sold by the author."
        tests:
          - not_null

  - name: revenue_by_publisher
    description: "Calculates total revenue and books sold by each publisher."
    tags:
      - sales
      - revenue
    columns:
      - name: publisher_name
        description: "Name of the publisher."
        tests:
          - not_null
      - name: total_revenue
        description: "Total revenue generated by the publisher's books."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of books sold by the publisher."
        tests:
          - not_null

  - name: sales_by_genre
    description: "Aggregates sales data by book genre, including revenue, units sold, and number of books."
    tags:
      - sales
      - genre
    columns:
      - name: genre_name
        description: "Name of the book genre."
        tests:
          - not_null
      - name: total_revenue
        description: "Total revenue generated by books in this genre."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of books sold in this genre."
        tests:
          - not_null
      - name: total_books
        description: "Total number of distinct books in this genre."
        tests:
          - not_null

  - name: top_selling_authors
    description: "Identifies the top-selling authors based on revenue and total books sold."
    tags:
      - sales
      - top_performers
    columns:
      - name: author_id
        description: "Unique identifier for each author."
        tests:
          - not_null
      - name: author_name
        description: "Name of the author."
      - name: total_revenue
        description: "Total revenue generated by the author's books."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of books sold by the author."
        tests:
          - not_null

  - name: top_selling_books_by_publisher
    description: "Lists the top-selling books for each publisher based on revenue and units sold."
    tags:
      - sales
      - top_performers
      - publishers
    columns:
      - name: publisher_name
        description: "Name of the publisher."
        tests:
          - not_null
      - name: ISBN
        description: "Unique identifier for each book."
        tests:
          - unique
          - not_null
      - name: title
        description: "Title of the book."
      - name: total_revenue
        description: "Total revenue generated by the book."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of copies sold for the book."
        tests:
          - not_null

  - name: top_selling_books_by_year
    description: "Identifies the top-selling books for each year based on revenue and units sold."
    tags:
      - sales
      - top_performers
      - yearly_trends
    columns:
      - name: sale_year
        description: "Year in which the book sales occurred."
        tests:
          - not_null
      - name: ISBN
        description: "Unique identifier for each book."
        tests:
          - unique
          - not_null
      - name: title
        description: "Title of the book."
      - name: total_revenue
        description: "Total revenue generated by the book in the given year."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of copies sold for the book in the given year."
        tests:
          - not_null

  - name: yearly_sales_trends
    description: "Analyzes yearly sales trends, including total revenue, units sold, and unique books sold."
    tags:
      - sales
      - yearly_trends
    meta:
      owner: "sales_team"
      kpis:
        - "yearly_revenue"
        - "units_sold"
    config:
      materialized: incremental
      unique_key: sale_year
    columns:
      - name: sale_year
        description: "Year in which the sales occurred."
        tests:
          - not_null
      - name: total_revenue
        description: "Total revenue generated in the year."
        tests:
          - not_null
      - name: total_books_sold
        description: "Total number of books sold in the year."
        tests:
          - not_null
      - name: unique_books_sold
        description: "Total number of unique books sold in the year."
        tests:
          - not_null
